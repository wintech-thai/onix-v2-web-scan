@model OnixWebScan.Models.VerifyViewModel
@using System.Text;
@using System.Net;
@using System.Collections.Generic;
@{
  ViewData["Title"] = "Verify";
  ViewData["MainClass"] = "ox-main ox-main--center";

  var p = Model?.Payload;
  var s = p?.ScanItem;

  string Norm(string? v) => string.IsNullOrWhiteSpace(v)
    ? "UNKNOWN"
    : v.Trim().ToUpperInvariant();

  var rawStatus = Norm(p?.Status);
  bool IsSuccess(string st) => st
    is "OK"
    or "SUCCESS"
    or "VALID";

  bool IsError(string st) => st
    is "ALREADY_REGISTERED"
    or "NOTFOUND"
    or "PARAM_MISSING"
    or "PARAMETER_MISSING"
    or "NO_DATA"
    or "MISSING_THEME"
    or "MISSING_ORG"
    or "DECRYPT_FAIL"
    or "DECRYPT_ERROR"
    or "INVALID"
    or "FAILED";
  bool isSuccess = IsSuccess(rawStatus);
  bool isError = IsError(rawStatus);
  bool isWarning = rawStatus == "ALREADY_REGISTERED";

  string statusCode = isSuccess ? "SUCCESS" : rawStatus;
  var titleText = isSuccess ? "ยืนยันแล้วว่าเป็นสินค้าแท้"
  : isError ? (rawStatus switch
  {
    "ALREADY_REGISTERED" => "โค้ดนี้ถูกใช้ไปแล้ว",
    "NOTFOUND" => "ไม่พบโค้ดนี้ในระบบ",
    "PARAM_MISSING" => "ข้อมูลที่ส่งมาไม่ครบ",
    "PARAMETER_MISSING" => "พารามิเตอร์หายไป",
    "NO_DATA" => "ไม่มีข้อมูล",
    "MISSING_THEME" => "ไม่มีข้อมูล theme ในลิงค์",
    "MISSING_ORG" => "ไม่มีข้อมูล org ในลิงค์",
    "DECRYPT_FAIL" or "DECRYPT_ERROR" => "ไม่สามารถถอดรหัสข้อมูลได้",
    "INVALID" => "โค้ดไม่ถูกต้อง",
    "FAILED" => "การตรวจสอบล้มเหลว",
    _ => "ตรวจสอบไม่ผ่าน"
  }) : "สถานะไม่แน่ชัด กรุณาติดต่อทีมงาน";

  var messages = new List<string>();
  if (isSuccess)
  {
    messages.Add("ขอบคุณที่ตรวจสอบ — คุณกำลังใช้สินค้าของแท้");
  }
  else if (isError)
  {
    switch (rawStatus)
    {
      case "ALREADY_REGISTERED":
        messages.Add("โค้ดนี้ถูกใช้งานไปก่อนหน้าหรืออาจถูกลงทะเบียนโดยผู้อื่น");
        messages.Add("กรุณาติดต่อทีมงานเพื่อช่วยตรวจสอบเพิ่มเติม");
        break;
      case "NOTFOUND":
        messages.Add("ไม่พบข้อมูลสินค้านี้ในระบบ สินค้าอาจไม่ได้ลงทะเบียนในระบบ");
        @* messages.Add("สินค้าอาจไม่ได้ลงทะเบียนในระบบ หรือข้อมูลอาจผิดพลาด"); *@
        break;
      case "PARAM_MISSING":
        messages.Add("ข้อมูลที่จำเป็นสำหรับการตรวจสอบไม่ครบถ้วน ไม่สามารถดำเนินการตรวจสอบความแท้ได้");
        @* messages.Add("ไม่สามารถดำเนินการตรวจสอบความแท้ได้"); *@
        break;
      case "PARAMETER_MISSING":
        messages.Add("พารามิเตอร์ที่ส่งมาตรวจสอบไม่ถูกต้องหรือหายไป กรุณาตรวจสอบลิงก์หรือ QR Code ที่ใช้ใหม่อีกครั้ง");
        @* messages.Add("กรุณาตรวจสอบลิงก์หรือ QR Code ที่ใช้ใหม่อีกครั้ง"); *@
        break;
      case "NO_DATA":
        messages.Add("ไม่มีข้อมูลสำหรับการตรวจสอบ ลิงก์หรือ QR Code อาจไม่ถูกต้อง หรือข้อมูลเสียหาย");
        @* messages.Add("ลิงก์หรือ QR Code อาจไม่ถูกต้อง หรือข้อมูลเสียหาย"); *@
        break;
      case "MISSING_THEME":
        messages.Add("ไม่มีข้อมูล theme ในลิงก์");
        @* messages.Add("ไม่มีข้อมูล theme ในลิงก์"); *@
        break;
      case "MISSING_ORG":
        messages.Add("ไม่มีข้อมูล org ในลิงก์");
        @* messages.Add("ไม่มีข้อมูล org ในลิงก์"); *@
        break;
      case "DECRYPT_FAIL":
        messages.Add("ไม่สามารถอ่านข้อมูลสินค้าได้ ข้อมูลอาจเสียหายหรือไม่ถูกต้อง");
        @* messages.Add("ข้อมูลอาจเสียหายหรือไม่ถูกต้อง"); *@
        break;
      case "INVALID":
        messages.Add("ข้อมูลสินค้าไม่ถูกต้องหรือไม่ตรงกับระบบ อาจเป็นสินค้าปลอมหรือข้อมูลถูกดัดแปลง");
        @* messages.Add("อาจเป็นสินค้าปลอมหรือข้อมูลถูกดัดแปลง"); *@
        break;
      case "FAILED":
        messages.Add("การตรวจสอบความแท้ล้มเหลว เกิดข้อผิดพลาดจากระบบ กรุณาลองใหม่อีกครั้งหรือติดต่อทีมงาน");
        @* messages.Add("เกิดข้อผิดพลาดจากระบบ กรุณาลองใหม่อีกครั้งหรือติดต่อทีมงาน"); *@
        break;
      default:
        messages.Add("ไม่สามารถตรวจสอบความแท้ได้ สถานะไม่รู้จัก กรุณาติดต่อทีมงานเพื่อรับการช่วยเหลือ");
        @* messages.Add("สถานะไม่รู้จัก กรุณาติดต่อทีมงานเพื่อรับการช่วยเหลือ"); *@
        break;
    }
  }
  else
  {
    messages.Add("ไม่สามารถสรุปผลได้จากข้อมูลที่ได้รับ");
    if (!string.IsNullOrWhiteSpace(p?.DescriptionEng)) messages.Add(p!.DescriptionEng);
  }

  string? encodedProductUrl = null;
  if (!string.IsNullOrWhiteSpace(s?.Url))
  {
    var b64 = Convert.ToBase64String(Encoding.UTF8.GetBytes(s!.Url));
    encodedProductUrl = WebUtility.UrlEncode(b64);
  }
  var primaryHref = isSuccess
  ? (encodedProductUrl is null ? "#" : Url.Action("OpenExternal", "Verify", new { u = encodedProductUrl }))
  : Url.Action("ContactSupport", "Verify", new { serial = s?.Serial, pin = s?.Pin, brand = s?.OrgId });
  var primaryText = isSuccess ? "เปิดข้อมูลสินค้า" : "ติดต่อทีมดูแล";
}

<div
  id="verifyContent"
  class="fade-container d-flex flex-column gap-3 align-items-center justify-content-center mx-auto"
  style="max-width:400px;"
>

  <!-- Status Badge -->
  <div
    class="text-white px-3 py-1 rounded-pill fw-semibold shadow-sm mb-1"
    style="background:@(isSuccess ? "linear-gradient(135deg,#6FE10A 0%,#58CD04 100%)" : isWarning ? "linear-gradient(135deg,#ffa726 0%,#ff9800 100%)" : "linear-gradient(135deg,#ff6b6b 0%,#ee5a24 100%)"); box-shadow:0 3px 8px @(isSuccess ? "rgba(111,225,10,.3)" : isWarning ? "rgba(255,167,38,.3)" : "rgba(255,107,107,.3)");">
    @(isSuccess ? "✓ ตรวจสอบสำเร็จ" : isWarning ? "⚠️ ระวัง" : "⚠️ พบปัญหา")
  </div>

  <!-- Success/Warning/Error Icon -->
  <div class="position-relative">
    @if (isSuccess)
    {
      <div class="rounded-circle p-3 mb-2 shadow"
           style="background:linear-gradient(135deg,#6FE10A 0%,#58CD04 100%); box-shadow:0 6px 16px rgba(111,225,10,.3);">
        <svg class="text-white" style="width:50px;height:50px;" fill="currentColor" viewBox="0 0 24 24">
          <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
        </svg>
      </div>
    }
    else if (isWarning)
    {
      <div class="rounded-circle p-3 mb-2 shadow"
           style="background:linear-gradient(135deg,#ffa726 0%,#ff9800 100%); box-shadow:0 6px 16px rgba(255,167,38,.3);">
        <svg class="text-white" style="width:50px;height:50px;" fill="currentColor" viewBox="0 0 24 24">
          <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
        </svg>
      </div>
    }
    else
    {
      <div class="rounded-circle p-3 mb-2 shadow"
           style="background:linear-gradient(135deg,#ff6b6b 0%,#ee5a24 100%); box-shadow:0 6px 16px rgba(255,107,107,.3);">
        <svg class="text-white" style="width:50px;height:50px;" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/>
        </svg>
      </div>
    }
  </div>

  <!-- Main Title -->
  <h2 class="fs-5 fw-bold text-center text-dark mb-0">
    @titleText
  </h2>

  @foreach (var line in messages)
  {
    <div class="text-center fs-6">@line</div>
  }

  <!-- Divider -->
  <hr class="w-100 my-2" />

  <!-- Product Info Details -->
  <div class="w-100 my-2 text-center">
    <!-- Serial -->
    @if (!string.IsNullOrEmpty(s?.Serial))
    {
      <div class="d-flex align-items-center justify-content-center gap-2 mb-2">
        <span class="fw-semibold text-secondary small">Serial :</span>
        <span id="serial-text" class="fw-bold text-dark font-monospace small">@s.Serial</span>
        <button onclick="copyText('@s.Serial','serial')" class="btn btn-outline-secondary btn-sm p-1 d-inline-flex align-items-center justify-content-center" title="Copy Serial" aria-label="Copy Serial">
          <svg style="width:16px;height:16px;" fill="currentColor" viewBox="0 0 24 24">
            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
          </svg>
        </button>
      </div>
    }

    <!-- Pin -->
    @if (!string.IsNullOrEmpty(s?.Pin))
    {
      <div class="d-flex align-items-center justify-content-center gap-2 mb-2">
        <span class="fw-semibold text-secondary small">Pin :</span>
        <span id="pin-text" class="fw-bold text-dark font-monospace small">@s.Pin</span>
        <button onclick="copyText('@s.Pin','pin')" class="btn btn-outline-secondary btn-sm p-1 d-inline-flex align-items-center justify-content-center" title="Copy Pin" aria-label="Copy Pin">
          <svg style="width:16px;height:16px;" fill="currentColor" viewBox="0 0 24 24">
            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
          </svg>
        </button>
      </div>
    }

    @if (isWarning && p?.ScanItem?.RegisteredDate != null)
    {
      <div class="d-flex align-items-center justify-content-center gap-2">
        <span class="fw-semibold text-secondary small">Registered At :</span>
        <span class="fw-bold text-dark small">
          @p.ScanItem?.RegisteredDate?.LocalDateTime.ToString("dd MMM yyyy HH:mm zzz")
        </span>
      </div>
    }
  </div>

  <!-- CTA Button -->
  @if (isSuccess || isWarning)
  {
    <button type="button"
            class="btn btn-success button_product border-0"
            data-bs-toggle="modal"
            data-bs-target="#productModal">
      <i class="fas fa-box-open me-2"></i>ดูข้อมูลสินค้า
    </button>
  }
  else
  {
    <a href="@primaryHref"
       class="button_product btn btn-primary w-100 text-center"
       style="text-decoration:none;">
      @primaryText
    </a>
  }

  <!-- Additional Info Message -->
  @if (isSuccess)
  {
    <div class="alert p-3 w-100 border-0 mb-0 border-start border-3 border-success"
         style="background:linear-gradient(135deg,#f0fff4 0%,#c6f6d5 100%);">
      <div class="d-flex align-items-center gap-2 mb-1">
        <svg class="text-success" style="width:20px;height:20px;" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M11,16.5L18,9.5L16.59,8.09L11,13.67L7.91,10.59L6.5,12L11,16.5Z"/>
        </svg>
        <div class="text-success fw-semibold small">ขอแสดงความยินดี!</div>
      </div>
      <div class="text-success small lh-sm">
        เพลิดเพลินกับสิทธิพิเศษและข้อเสนอพิเศษของเรา
      </div>
    </div>
  }
  else if (isWarning)
  {
    <div class="alert p-3 w-100 border-0 mb-0 border-start border-3"
         style="--bs-border-opacity:1;border-color:#ffa726;background:linear-gradient(135deg,#fff8e1 0%,#ffecb3 100%);">
      <div class="d-flex align-items-center gap-2 mb-1">
        <svg class="text-warning" style="width:20px;height:20px;color:#ffa726;" fill="currentColor" viewBox="0 0 24 24">
          <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
        </svg>
        <div class="fw-semibold small" style="color:#e65100;">ต้องระวัง!</div>
      </div>
      <div class="small lh-sm" style="color:#e65100;">
        @(messages.FirstOrDefault() ?? "โค้ดนี้ถูกใช้งานไปแล้ว")
      </div>
    </div>
  }
  else
  {
    <div class="alert p-3 w-100 border-0 mb-0 border-start border-3 border-danger"
         style="background:linear-gradient(135deg,#fed7d7 0%,#feb2b2 100%);">
      <div class="d-flex align-items-center gap-2 mb-1">
        <svg class="text-danger" style="width:20px;height:20px;" fill="currentColor" viewBox="0 0 24 24">
          <path d="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/>
        </svg>
        <div class="text-danger fw-semibold small">ต้องการความช่วยเหลือ?</div>
      </div>
      <div class="text-danger small lh-sm">
        @(messages.FirstOrDefault() ?? "กรุณาติดต่อทีมงาน")
      </div>
    </div>
  }
</div>


  <style>
    .fade-container {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 1s ease-out, transform 1s ease-out;
    }

    .fade-container.show {
      opacity: 1;
      transform: translateY(0);
    }

    .button_product {
      width: 100%;
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      background: @(isSuccess ? "linear-gradient(135deg, #6FE10A 0%, #58CD04 100%)" : isWarning ? "linear-gradient(135deg, #ffa726 0%, #ff9800 100%)" : "linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)");
      color: #fff;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 3px 8px @(isSuccess ? "rgba(111, 225, 10, 0.25)" : isWarning ? "rgba(255, 167, 38, 0.25)" : "rgba(66, 153, 225, 0.25)");
      position: relative;
      overflow: hidden;
    }

    .button_product::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s ease;
    }

    .button_product:hover {
      box-shadow: 0 6px 12px @(isSuccess ? "rgba(111, 225, 10, 0.35)" : isWarning ? "rgba(255, 167, 38, 0.35)" : "rgba(66, 153, 225, 0.35)");
      background: @(isSuccess ? "linear-gradient(135deg, #7FE91A 0%, #68DD14 100%)" : isWarning ? "linear-gradient(135deg, #ffb74d 0%, #ffa726 100%)" : "linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%)");
      color: white;
      opacity: 0.95;
    }

    .button_product:hover::before {
      left: 100%;
    }

    .button_product:active {
      transform: translateY(0px);
      box-shadow: 0 3px 8px @(isSuccess ? "rgba(111, 225, 10, 0.2)" : isWarning ? "rgba(255, 167, 38, 0.2)" : "rgba(66, 153, 225, 0.2)");
    }

    /* Info card hover effects */
    .info-detail {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .info-detail:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    /* Responsive design */
    @@media (max-width: 480px) {
      #verifyContent {
        max-width: 340px !important;
        padding: 20px 16px !important;
        margin: 8px !important;
        gap: 10px !important;
      }

      .button_product {
        padding: 12px 18px;
        font-size: 14px;
      }
    }

    /* Ensure single page view */
    @@media (max-height: 800px) {
      #verifyContent {
        gap: 8px !important;
        padding: 20px !important;
      }
    }
  </style>

@if (isSuccess)
{
  <!-- Confetti CDN -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script>
    (function () {
      if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

      // ชุดใหญ่ไฟกระพริบครั้งแรก
      try {
        confetti({
          particleCount: 120,
          spread: 90,
          startVelocity: 38,
          origin: { y: 0.6 }
        });

        // ยิงจากซ้าย-ขวา แบบต่อเนื่อง ~1.5 วิ
        const duration = 1500;
        const end = Date.now() + duration;

        (function frame() {
          confetti({
            particleCount: 2,
            angle: 60,
            spread: 55,
            origin: { x: 0 }
          });
          confetti({
            particleCount: 2,
            angle: 120,
            spread: 55,
            origin: { x: 1 }
          });
          if (Date.now() < end) requestAnimationFrame(frame);
        })();
      } catch (e) {
        // ถ้าโหลด CDN ไม่สำเร็จ จะไม่พังหน้าจอ
        console.warn('confetti init failed', e);
      }
    })();
  </script>
}

  @* Animation fade-in *@
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const content = document.getElementById("verifyContent");
      setTimeout(() => {
        content.classList.add("show");
      }, 300);
    });

    // Copy function
    function copyText(text, type) {
      navigator.clipboard.writeText(text)
    }

    // Initialize carousel when modal is shown
    document.addEventListener('DOMContentLoaded', function() {
      const productModal = document.getElementById('productModal');
      if (productModal) {
        productModal.addEventListener('shown.bs.modal', function () {
          const carousel = document.querySelector('#productCarousel');
          if (carousel) {
            // Re-initialize Bootstrap carousel
            const bootstrapCarousel = new bootstrap.Carousel(carousel, {
              interval: 5000,
              ride: 'carousel',
              wrap: true,
              keyboard: true,
              pause: 'hover'
            });
          }
        });
      }
    });
  </script>

<!-- Modal (Bootstrap utilities + inline สำหรับ gradient/custom) -->
<div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
  <div class="modal-dialog @(p?.ProductData?.Item == null ? "modal-md" : "modal-xl") modal-fullscreen-xl-down modal-dialog-centered">
    <div class="modal-content border-0 rounded-4 shadow-lg">
      <div class="modal-header text-white rounded-top-4 border-0" style="background:#183153;">
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body p-4" style="background:#f7f8fb;">
        @if (p?.ProductData?.Item != null)
        {
          var product = p.ProductData.Item;
          var images  = p.ProductData.Images ?? new List<ProductImage>();
          var props   = product?.PropertiesObj;

          <div class="row">
            <!-- LEFT -->
            <div class="col-12 col-lg-6 text-center">
              @if (images.Any())
              {
                var carouselId = "productCarousel";
                <div id="@carouselId" class="carousel slide mb-3 rounded-3 shadow-sm bg-white overflow-hidden"
                     data-bs-ride="carousel" data-bs-touch="true" data-bs-interval="5000">
                  <div class="carousel-inner">
                    @for (int i = 0; i < images.Count; i++)
                    {
                      var img = images[i];
                      <div class="carousel-item @(i == 0 ? "active" : "") position-relative">
                        <img src="@img.ImageUrl"
                             class="d-block w-100"
                             alt="Product Image @(i+1)"
                             style="height:420px;object-fit:cover;"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        @if (!string.IsNullOrEmpty(img.Narative))
                        {
                          <div class="position-absolute bottom-0 start-0 end-0 p-2 text-white fs-6"
                               style="background:linear-gradient(transparent,rgba(0,0,0,.72));">
                            @img.Narative
                          </div>
                        }
                      </div>
                    }
                  </div>

                  @if (images.Count > 1)
                  {
                    <button class="carousel-control-prev bg-dark bg-opacity-50 rounded-end" type="button"
                            data-bs-target="#@carouselId" data-bs-slide="prev" style="width:50px;height:60px;top:50%;transform:translateY(-50%);left:10px;">
                      <span class="carousel-control-prev-icon"></span>
                      <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next bg-dark bg-opacity-50 rounded-start" type="button"
                            data-bs-target="#@carouselId" data-bs-slide="next" style="width:50px;height:60px;top:50%;transform:translateY(-50%);right:10px;">
                      <span class="carousel-control-next-icon"></span>
                      <span class="visually-hidden">Next</span>
                    </button>
                  }
                </div>
              }

              <!-- Meta -->
              <div class="row g-2 mt-3">
                <div class="col-12 col-lg-6">
                  <div class="bg-white p-3 rounded-3 shadow-sm">
                    <div class="small text-muted">ผู้ผลิต</div>
                    <div class="fw-semibold text-dark">@(product?.OrgId ?? "-")</div>
                  </div>
                </div>
                <div class="col-12 col-lg-6">
                  <div class="bg-white p-3 rounded-3 shadow-sm">
                    <div class="small text-muted">อัปเดตล่าสุด</div>
                    <div class="fw-semibold text-dark">@(product?.UpdatedDate?.LocalDateTime.ToString("dd MMM yyyy HH:mm zzz") ?? "-")</div>
                  </div>
                </div>
              </div>

              @if (!string.IsNullOrWhiteSpace(product?.PropertiesObj?.ProductUrl))
              {
                <div class="mt-2">
                  <a href="@product.PropertiesObj.ProductUrl" target="_blank" class="fs-6 text-primary text-decoration-none">รายละเอียดเพิ่มเติมของสินค้า</a>
                </div>
              }
            </div>

            <!-- RIGHT -->
            <div class="col-12 col-lg-6 mt-4 mt-lg-0">
              <h4 class="fw-bold text-dark fs-3 mb-3">@(product?.Code ?? "-")</h4>
              <p class="text-muted fs-5 mb-3">@(product?.Description ?? product?.Narrative ?? "ไม่มีคำอธิบาย")</p>

              <!-- Specs -->
              <div class="row g-2 mb-3">
                <div class="col-6">
                  <div class="bg-white p-3 rounded-3 shadow-sm text-center">
                    <div class="text-primary fs-5 mb-1">🏷️</div>
                    <div class="fw-semibold text-dark fs-6">ประเภทสินค้า</div>
                    <div class="text-muted fs-6">@(product?.PropertiesObj?.Category ?? "-")</div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="bg-white p-3 rounded-3 shadow-sm text-center">
                    <div class="text-primary fs-5 mb-1">❓</div>
                    <div class="fw-semibold text-dark fs-6">ความสูง</div>
                    <div class="text-muted fs-6">@(product?.PropertiesObj?.Height > 0 ? $"{product.PropertiesObj.Height} {(product?.PropertiesObj?.DimentionUnit ?? "cm")}" : "-")</div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="bg-white p-3 rounded-3 shadow-sm text-center">
                    <div class="text-primary fs-5 mb-1">📐</div>
                    <div class="fw-semibold text-dark fs-6">ความกว้าง</div>
                    <div class="text-muted fs-6">@(props?.Width > 0 ? $"{props.Width} {(props?.DimentionUnit ?? "cm")}" : "-")</div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="bg-white p-3 rounded-3 shadow-sm text-center">
                    <div class="text-primary fs-5 mb-1">⚖️</div>
                    <div class="fw-semibold text-dark fs-6">น้ำหนัก</div>
                    <div class="text-muted fs-6">@(props?.Weight > 0 ? $"{props.Weight} {(props?.WeightUnit ?? "g")}" : "-")</div>
                  </div>
                </div>
              </div>

              <!-- Features -->
              @if (!string.IsNullOrEmpty(product?.Narrative))
              {
                var bullets = product.Narrative.Split('|', StringSplitOptions.RemoveEmptyEntries);
                <div class="bg-white p-4 rounded-3 shadow-sm">
                  <h6 class="fw-semibold text-dark fs-5 mb-3">คุณสมบัติเด่น</h6>
                  @if (bullets.Length > 0)
                  {
                    <div class="d-grid gap-2">
                      @foreach (var b in bullets)
                      {
                        <div class="d-flex align-items-center gap-2">
                          <div class="rounded-circle" style="width:6px;height:6px;background:#6FE10A;"></div>
                          <span class="text-secondary fs-6">@b.Trim()</span>
                        </div>
                      }
                    </div>
                  }
                  else
                  {
                    <div class="text-muted fs-6">@product.Narrative</div>
                  }
                </div>
              }
            </div>
          </div>
        }
        else
        {
          <div class="p-5 my-4 text-center">
            <svg class="mb-3 text-danger" style="width:64px;height:64px;" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12,2A10,10 0 1,0 22,12A10,10 0 0,0 12,2M13,13H11V7h2v6m0,4H11v-2h2v2z"/>
            </svg>
            <h5 class="fw-bold text-danger mb-2">ไม่พบข้อมูลสินค้า [@p.ProductData?.Status]</h5>
            <p class="fs-6 text-muted mb-0">ขออภัย ไม่สามารถโหลดข้อมูลสินค้าได้ในขณะนี้</p>
          </div>
        }
      </div>

      <div class="modal-footer border-0 rounded-bottom-4 p-3 bg-white">
        <button type="button" class="btn btn-light text-muted fw-medium px-3 py-2 rounded-2" data-bs-dismiss="modal">ปิด</button>
        @if (!string.IsNullOrWhiteSpace(p?.ProductData?.Item?.PropertiesObj?.SupplierUrl)) {
            <a href="@p.ProductData.Item.PropertiesObj.SupplierUrl" target="_blank"
               class="btn text-white fw-medium px-3 py-2 rounded-2"
               style="background:#183153; text-decoration:none;">
                เว็บไซต์ผู้ผลิต
            </a>
        }
      </div>
    </div>
  </div>
</div>



@* <div class="container ox-container":
  <div class="hero @heroBg">
    <div class="statusWrap">
      <svg class="statusIcon"><use href="#@iconId" /></svg>
      <div>
        <div class="statusCode">@statusCode</div>
        <div class="statusTitle">@titleText</div>
      </div>
    </div>

    <div class="lead">
      @foreach (var line in messages) { <div class="line">@line</div> }
    </div>

    <div class="cta">
      <a class="btn" href="@primaryHref"><svg><use href="#i-link"/></svg> @primaryText</a>
    </div>
  </div>
</div> *@
